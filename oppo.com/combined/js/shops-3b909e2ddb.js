$(document).ready(function(){function e(e,s){for(var o="",t=15*(e-1),a=1,n=t,c=t+15;n<c;n++){var r=s.shops[n]?s.shops[n].shopName:null,i=s.shops[n]?s.shops[n].shopType:null,l=s.shops[n]?s.shops[n].shopAddress:null,d=s.shops[n]?s.shops[n].shopTel:null;r&&i&&l&&d&&(o+='<li class="store-location"><span class="marker">'+a+'</span><div class="store-location-info"><div class="store-location-info-name"><p><strong>'+r+'</strong></p><p><a class="view-details" href="javascript:;">查看详情</a></p></div><div class="store-location-info-type"><p>'+i+'</p></div><div class="store-location-info-address"><p>'+l+'</p></div><div class="store-location-info-tel"><p>'+d+"</p></div></div></li>"),a++}""!=o?($(".location-address .store-list")[0].innerHTML=o,$(".location-address .pagination li").eq(e).addClass("active").siblings().removeClass("active")):alert("已到最后一页！")}function s(e,s){var o=e+" · 体验店 ("+s+")";$(".location-address .title")[0].innerHTML=o}function o(e){var s=new BMap.Map("baiduMap");s.centerAndZoom(e,11),s.addControl(new BMap.ScaleControl),s.addControl(new BMap.NavigationControl),s.enableScrollWheelZoom(!0),new BMap.LocalSearch(s,{renderOptions:{map:s}}).search("OPPO体验店"),console.log("百度地图显示城市："+e)}function t(){var e=new BMap.Map("baiduMap");e.centerAndZoom("北京市",11),e.addControl(new BMap.ScaleControl),e.addControl(new BMap.NavigationControl),e.enableScrollWheelZoom(!0)}function a(e){e="请选择"==e?"":e,$(".hero .input-item input").attr("value",e)}function n(e,s){for(var o="",t="",a=1,n=s+1;a<n;a++)o+='<li><a href="javascript:;">'+a+"</a></li>";t='<li><a class="disabled prev" href="javascript:;">«</a></li>'+o+'<li><a class="disabled next" href="javascript:;">»</a></li>',$(e).html(t),console.log("pageHtml:"+t)}var c=new BMap.Geolocation,r=new BMap.Geocoder,i=$(".location-address .pagination"),l=0;window.address={},address.currentprovince="北京市",address.currentcity="北京市",address.selectedprovince="北京市",address.selectedcity="北京市",$("#select1").change(function(){console.log("address.selectedprovince:"+address.selectedprovince),$.getJSON("/shops/json/oppoShops1.json",function(e){console.log(e);for(var s=$.grep(e,function(e,s){return e.province==address.selectedprovince}),o="",t=s[0].city.length,a=0;a<t;a++)o+=0==a?'<option selected="selected">'+s[0].city[a]+"</option>":"<option>"+s[0].city[a]+"</option>";$("#select2").html(o),console.dir(s),console.dir("city:"+s[0].city+"province:"+s[0].province),console.log("cityLength:"+t),console.log("html:"+o)}),address.selectedprovince=$(this).val(),address.selectedcity=$("#select2").val(),a(address.selectedcity),"请选择"==address.selectedprovince?t():o(address.selectedprovince);var s,c,r=$.getJSON("/shops/json/oppoShopsDetails.json",function(e){});window.data=r,console.log("#select1-change-data:"+r.responseJSON),s=(s=$.grep(r.responseJSON,function(e){return c="请选择"==address.selectedcity?address.currentcity:address.selectedcity,e.cityName==c}))[0],console.log("#select1-change-jsonData:"+s),l=s.shops.length,l=l%15==0?parseInt(l/15):parseInt(l/15)+1,n(i,l),e(1,s[0])}),$("#select2").change(function(){address.selectedcity=$(this).val(),a(address.selectedcity),o($(this).val()),$(".location-address .pagination li:first-child").trigger("click")}),c.getCurrentPosition(function(e){if(this.getStatus()==BMAP_STATUS_SUCCESS){var s=e.point;r.getLocation(s,function(e){var s=e.addressComponents;address.currentprovince=s.province,address.currentcity=s.city,$("#select1").val(address.currentprovince),$("#select1").trigger("change"),"请选择"==address.currentcity?t():o(address.currentcity),console.log("province:"+address.currentprovince+"city:"+address.currentcity)})}else switch(this.getStatus()){case 2:alert("位置结果未知 获取位置失败.");break;case 3:alert("导航结果未知 获取位置失败..");break;case 4:alert("非法密钥 获取位置失败.");break;case 5:alert("对不起,非法请求位置 获取位置失败.");break;case 6:alert("对不起,当前 没有权限 获取位置失败.");break;case 7:alert("对不起,服务不可用 获取位置失败.");break;case 8:alert("对不起,请求超时 获取位置失败.")}},{enableHighAccuracy:!0}),$.getJSON("/shops/json/oppoShops1.json",function(e){$.grep(e,function(e,s){return e.province==address.currentprovince})}),$(".location-address .pagination li").each(function(o,t){$(t).click(function(){var t=o,a={};$.getJSON("/shops/json/oppoShopsDetails.json",function(o){a=$.grep(o,function(e,s){return e.cityName==address.selectedcity}),a=a[0],e(t,a),s(a.cityName,a.shops.length)})})}),$(".location-address .pagination li").eq(1).trigger("click")});